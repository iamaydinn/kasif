<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>KÃ‚ÅžÄ°F - YÃ¶netim Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style> body { font-family: sans-serif; background-color: #0f172a; color: white; } </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-slate-900 border-r border-slate-700 flex flex-col">
        <div class="h-20 flex items-center justify-center border-b border-slate-700 text-xl font-bold text-yellow-500 tracking-widest">
            YÃ–NETÄ°M
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <button onclick="switchTab('users')" class="w-full text-left p-3 rounded hover:bg-slate-800 bg-slate-800 text-white"><i class="fa-solid fa-users mr-2"></i> KullanÄ±cÄ±lar</button>
            <button onclick="switchTab('shop')" class="w-full text-left p-3 rounded hover:bg-slate-800 text-slate-400"><i class="fa-solid fa-store mr-2"></i> MaÄŸaza</button>
            <button onclick="switchTab('games')" class="w-full text-left p-3 rounded hover:bg-slate-800 text-slate-400"><i class="fa-solid fa-gamepad mr-2"></i> Oyunlar</button>
        </nav>
        <button onclick="location.href='portal.html'" class="m-4 p-3 border border-slate-600 rounded hover:bg-slate-800 text-center">Portala DÃ¶n ðŸš€</button>
    </aside>

    <main class="flex-1 p-8 overflow-y-auto">
        <div id="tab-users" class="content-tab">
            <h2 class="text-2xl font-bold mb-4">KullanÄ±cÄ± Listesi</h2>
            <div class="bg-slate-800 rounded-xl overflow-hidden border border-slate-700">
                <table class="w-full text-left"><tbody id="users-list"></tbody></table>
            </div>
        </div>

        <div id="tab-shop" class="content-tab hidden">
            <div class="flex justify-between mb-4"><h2 class="text-2xl font-bold">MaÄŸaza ÃœrÃ¼nleri</h2><button onclick="document.getElementById('modal-shop').classList.remove('hidden')" class="bg-yellow-600 px-4 py-2 rounded font-bold">+ ÃœrÃ¼n Ekle</button></div>
            <div id="shop-list" class="grid grid-cols-4 gap-4"></div>
        </div>

        <div id="tab-games" class="content-tab hidden">
            <div class="flex justify-between mb-4"><h2 class="text-2xl font-bold">Oyunlar</h2><button onclick="document.getElementById('modal-game').classList.remove('hidden')" class="bg-green-600 px-4 py-2 rounded font-bold">+ Oyun Ekle</button></div>
            <div id="games-list" class="grid grid-cols-4 gap-4"></div>
        </div>
    </main>

    <div id="modal-shop" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-96 p-6 rounded-xl border border-slate-600 space-y-3">
            <h3 class="font-bold text-xl">ÃœrÃ¼n Ekle</h3>
            <input id="prod-name" placeholder="AdÄ±" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
            <input id="prod-price" type="number" placeholder="Fiyat" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
            <input id="prod-icon" placeholder="Ä°kon (Emoji)" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
            <select id="prod-type" class="w-full bg-slate-900 p-2 rounded border border-slate-700"><option value="badge">Rozet</option><option value="effect">Efekt</option></select>
            <input id="prod-effect" placeholder="Efekt Class (Opsiyonel)" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
            <button onclick="addItem()" class="w-full bg-yellow-600 py-2 rounded font-bold">Ekle</button>
            <button onclick="document.getElementById('modal-shop').classList.add('hidden')" class="w-full text-slate-400 py-2">Kapat</button>
        </div>
    </div>

    <div id="modal-game" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-96 p-6 rounded-xl border border-slate-600 space-y-3">
            <h3 class="font-bold text-xl">Oyun Ekle</h3>
            <input id="game-title" placeholder="Oyun AdÄ±" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
            <select id="game-cat" class="w-full bg-slate-900 p-2 rounded border border-slate-700"><option>Tarih</option><option>CoÄŸrafya</option><option>Bilim</option></select>
            <input id="game-img" placeholder="Resim URL" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
            <input id="game-url" placeholder="Embed URL" class="w-full bg-slate-900 p-2 rounded border border-slate-700">
            <button onclick="addGame()" class="w-full bg-green-600 py-2 rounded font-bold">Ekle</button>
            <button onclick="document.getElementById('modal-game').classList.add('hidden')" class="w-full text-slate-400 py-2">Kapat</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyD5SFoL8-4idNlbixCw81pjWMn6M6-yv1A", authDomain: "kasif-cd133.firebaseapp.com", projectId: "kasif-cd133", storageBucket: "kasif-cd133.firebasestorage.app", messagingSenderId: "734052460302", appId: "1:734052460302:web:9c8b1747e3dcbdff6c195f", measurementId: "G-VZ04P8EQ69" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app, "kasif");

        window.switchTab = (tab) => {
            document.querySelectorAll('.content-tab').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-'+tab).classList.remove('hidden');
            if(tab==='users') loadUsers(); if(tab==='shop') loadShop(); if(tab==='games') loadGames();
        };

        window.loadUsers = async () => {
            const list = document.getElementById('users-list'); list.innerHTML = 'YÃ¼kleniyor...';
            const s = await getDocs(collection(db, "users")); list.innerHTML = '';
            s.forEach(d => {
                const u = d.data();
                list.innerHTML += `<tr class="border-b border-slate-700"><td class="p-4 font-bold">${u.username}</td><td class="p-4">${u.role||'Student'}</td><td class="p-4 text-right"><button onclick="toggleRole('${d.id}','${u.role}')" class="bg-blue-600 px-3 py-1 rounded text-xs">Rol DeÄŸiÅŸtir</button></td></tr>`;
            });
        };

        window.toggleRole = async (id, role) => {
            await updateDoc(doc(db,"users",id), {role: role==='teacher'?'student':'teacher'}); loadUsers();
        };

        window.loadShop = async () => {
            const list = document.getElementById('shop-list'); list.innerHTML = 'YÃ¼kleniyor...';
            const s = await getDocs(collection(db, "shop_items")); list.innerHTML = '';
            s.forEach(d => { const i=d.data(); list.innerHTML += `<div class="bg-slate-800 p-4 rounded border border-slate-600 text-center"><div class="text-2xl">${i.icon}</div><div>${i.name}</div><button onclick="delItem('shop_items','${d.id}')" class="text-red-500 text-xs mt-2">Sil</button></div>`; });
        };

        window.addItem = async () => {
            await addDoc(collection(db,"shop_items"), {
                name: document.getElementById('prod-name').value,
                price: Number(document.getElementById('prod-price').value),
                icon: document.getElementById('prod-icon').value,
                type: document.getElementById('prod-type').value,
                effectClass: document.getElementById('prod-effect').value
            });
            document.getElementById('modal-shop').classList.add('hidden'); loadShop();
        };

        window.loadGames = async () => {
            const list = document.getElementById('games-list'); list.innerHTML = 'YÃ¼kleniyor...';
            const s = await getDocs(collection(db, "games")); list.innerHTML = '';
            s.forEach(d => { const g=d.data(); list.innerHTML += `<div class="bg-slate-800 p-2 rounded border border-slate-600"><img src="${g.img}" class="h-20 w-full object-cover opacity-50"><div>${g.title}</div><button onclick="delItem('games','${d.id}')" class="text-red-500 text-xs">Sil</button></div>`; });
        };

        window.addGame = async () => {
            await addDoc(collection(db,"games"), {
                title: document.getElementById('game-title').value,
                cat: document.getElementById('game-cat').value,
                img: document.getElementById('game-img').value,
                url: document.getElementById('game-url').value
            });
            document.getElementById('modal-game').classList.add('hidden'); loadGames();
        };

        window.delItem = async (col, id) => { if(confirm('Sil?')) { await deleteDoc(doc(db,col,id)); if(col==='games')loadGames(); else loadShop(); } };

        onAuthStateChanged(auth, u => { if(u) loadUsers(); else location.href="login.html"; });
    </script>
</body>
</html>
