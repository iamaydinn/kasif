<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>KÃ‚ÅÄ°F - GÃ¶rev Kontrol Merkezi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .swal2-container { z-index: 999999 !important; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        /* Modal Overlay */
        .modal-overlay { z-index: 50; background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-72 bg-slate-900 border-r border-slate-700 flex flex-col shadow-2xl z-20">
        <div class="h-24 flex items-center justify-center border-b border-slate-700 bg-slate-950">
            <div class="text-center">
                <h1 class="text-2xl font-black text-red-500 tracking-widest"><i class="fa-solid fa-shield-halved mr-2"></i>ADMIN</h1>
                <p class="text-[10px] text-slate-500 font-mono">SYSTEM V16 - ROOT ACCESS</p>
            </div>
        </div>
        
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <div class="text-xs font-bold text-slate-500 uppercase ml-2 mb-2 mt-2">KullanÄ±cÄ± & SÄ±nÄ±f</div>
            <button onclick="window.admin.switchTab('users')" class="w-full text-left p-3 rounded-xl hover:bg-slate-800 transition flex items-center gap-3 bg-slate-800 text-white shadow-lg tab-btn" id="btn-users">
                <div class="w-8 h-8 rounded bg-blue-600 flex items-center justify-center"><i class="fa-solid fa-users"></i></div>
                <span>Ã–ÄŸrenci YÃ¶netimi</span>
            </button>
            
            <div class="text-xs font-bold text-slate-500 uppercase ml-2 mb-2 mt-4">Ä°Ã§erik & Ekonomi</div>
            <button onclick="window.admin.switchTab('shop')" class="w-full text-left p-3 rounded-xl hover:bg-slate-800 transition flex items-center gap-3 tab-btn" id="btn-shop">
                <div class="w-8 h-8 rounded bg-yellow-600 flex items-center justify-center"><i class="fa-solid fa-store"></i></div>
                <span>MaÄŸaza & ÃœrÃ¼nler</span>
            </button>
            <button onclick="window.admin.switchTab('games')" class="w-full text-left p-3 rounded-xl hover:bg-slate-800 transition flex items-center gap-3 tab-btn" id="btn-games">
                <div class="w-8 h-8 rounded bg-green-600 flex items-center justify-center"><i class="fa-solid fa-gamepad"></i></div>
                <span>Oyun KÃ¼tÃ¼phanesi</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-700">
            <button onclick="location.href='portal.html'" class="w-full p-3 rounded-xl border border-slate-600 hover:bg-slate-800 transition flex items-center justify-center gap-2 text-slate-400 hover:text-white">
                <i class="fa-solid fa-rocket"></i> Portala Git
            </button>
        </div>
    </aside>

    <main class="flex-1 bg-slate-950 relative overflow-hidden flex flex-col">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20 pointer-events-none"></div>

        <header class="h-20 border-b border-slate-800 flex items-center justify-between px-8 bg-slate-900/80 backdrop-blur z-10">
            <h2 class="text-2xl font-bold text-white flex items-center gap-2"><i class="fa-solid fa-users-gear text-blue-500"></i> YÃ¶netim Paneli</h2>
            <div class="flex gap-4">
                <div class="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700 text-xs">
                    <span class="text-slate-400">Ã–ÄŸrenci SayÄ±sÄ±:</span> <span id="stat-users" class="font-bold text-white text-lg ml-1">0</span>
                </div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-8 relative z-10">
            
            <div id="tab-users" class="content-tab space-y-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-white">KayÄ±tlÄ± KÃ¢ÅŸifler</h3>
                    <button onclick="window.admin.loadUsers()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2"><i class="fa-solid fa-rotate"></i> Yenile</button>
                </div>
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4" id="users-grid">
                    <div class="text-slate-500">KullanÄ±cÄ±lar yÃ¼kleniyor...</div>
                </div>
            </div>

            <div id="tab-shop" class="content-tab hidden space-y-6">
                <div class="flex justify-between items-center bg-slate-900 p-6 rounded-2xl border border-slate-700 shadow-xl">
                    <div>
                        <h3 class="text-xl font-bold text-white">MaÄŸaza KataloÄŸu</h3>
                        <p class="text-slate-400 text-sm">Ã–ÄŸrencilerin alabileceÄŸi Ã¼rÃ¼nleri yÃ¶net.</p>
                    </div>
                    <button onclick="window.admin.openModal('modal-add-shop')" class="bg-yellow-600 hover:bg-yellow-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2"><i class="fa-solid fa-plus"></i> ÃœrÃ¼n Ekle</button>
                </div>
                <div id="shop-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
            </div>

            <div id="tab-games" class="content-tab hidden space-y-6">
                <div class="flex justify-between items-center bg-slate-900 p-6 rounded-2xl border border-slate-700 shadow-xl">
                    <div>
                        <h3 class="text-xl font-bold text-white">Oyun KÃ¼tÃ¼phanesi</h3>
                        <p class="text-slate-400 text-sm">LearningApps, Wordwall vb. embed kodlarÄ±nÄ± ekle.</p>
                    </div>
                    <button onclick="window.admin.openModal('modal-add-game')" class="bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2"><i class="fa-solid fa-plus"></i> Oyun Ekle</button>
                </div>
                <div id="games-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
            </div>

        </div>
    </main>

    <div id="modal-manage-user" class="fixed inset-0 hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-slate-900 w-full max-w-2xl rounded-3xl border border-slate-600 overflow-hidden shadow-2xl flex flex-col max-h-[90vh]">
            <div class="bg-slate-800 p-6 flex items-center gap-4 border-b border-slate-700">
                <img id="m-avatar" src="" class="w-20 h-20 rounded-full border-4 border-slate-600 bg-slate-950">
                <div class="flex-1">
                    <h3 id="m-username" class="text-2xl font-black text-white">KullanÄ±cÄ± AdÄ±</h3>
                    <p id="m-email" class="text-slate-400 font-mono text-sm">email@email.com</p>
                    <div id="m-badges" class="flex gap-1 mt-2 text-xl overflow-x-auto"></div>
                </div>
                <button onclick="window.admin.closeModal('modal-manage-user')" class="bg-slate-700 hover:bg-slate-600 text-white w-10 h-10 rounded-full font-bold">X</button>
            </div>
            
            <div class="p-6 overflow-y-auto grid grid-cols-2 gap-6">
                <div class="space-y-3">
                    <h4 class="font-bold text-slate-400 uppercase text-xs border-b border-slate-700 pb-1">VarlÄ±klar</h4>
                    <div class="flex gap-2 items-center">
                        <span class="w-20 text-sm text-slate-300">AltÄ±n:</span>
                        <input id="m-coins" type="number" class="flex-1 bg-slate-950 border border-slate-700 rounded p-2 text-white">
                    </div>
                    <div class="flex gap-2 items-center">
                        <span class="w-20 text-sm text-slate-300">XP:</span>
                        <input id="m-xp" type="number" class="flex-1 bg-slate-950 border border-slate-700 rounded p-2 text-white">
                    </div>
                    <div class="flex gap-2 items-center">
                        <span class="w-20 text-sm text-slate-300">Ãœnvan:</span>
                        <input id="m-title" type="text" class="flex-1 bg-slate-950 border border-slate-700 rounded p-2 text-white">
                    </div>
                    <button onclick="window.admin.saveUserChanges()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-bold mt-2">DeÄŸiÅŸiklikleri Kaydet</button>
                </div>

                <div class="space-y-2">
                    <h4 class="font-bold text-slate-400 uppercase text-xs border-b border-slate-700 pb-1">HÄ±zlÄ± Ä°ÅŸlemler</h4>
                    <button onclick="window.admin.toggleTeacherRole()" id="btn-role" class="w-full bg-orange-900/50 hover:bg-orange-600 text-orange-200 border border-orange-700/50 py-2 rounded font-bold text-sm transition">ğŸ“ Ã–ÄŸretmen Yap</button>
                    <button onclick="window.admin.giveBadgePrompt()" class="w-full bg-purple-900/50 hover:bg-purple-600 text-purple-200 border border-purple-700/50 py-2 rounded font-bold text-sm transition">ğŸ… Rozet Ver</button>
                    <button onclick="window.admin.sendWarningPrompt()" class="w-full bg-yellow-900/50 hover:bg-yellow-600 text-yellow-200 border border-yellow-700/50 py-2 rounded font-bold text-sm transition">âš ï¸ UyarÄ± GÃ¶nder</button>
                </div>

                <div class="col-span-2 border-t border-red-900/30 pt-4 mt-2">
                    <h4 class="font-bold text-red-500 uppercase text-xs mb-2">Tehlikeli BÃ¶lge</h4>
                    <div class="flex gap-3">
                        <button onclick="window.admin.banUser()" id="btn-ban" class="flex-1 bg-red-950 hover:bg-red-700 text-red-400 border border-red-900 py-2 rounded font-bold text-sm transition">ğŸš« Yasakla (Ban)</button>
                        <button onclick="window.admin.deleteUser()" class="flex-1 bg-black hover:bg-red-900 text-slate-400 border border-slate-700 py-2 rounded font-bold text-sm transition">ğŸ—‘ï¸ HesabÄ± Sil</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-add-shop" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-full max-w-sm p-6 rounded-2xl border border-slate-600">
            <h3 class="text-xl font-bold text-white mb-4">Markete ÃœrÃ¼n Ekle</h3>
            <div class="space-y-3">
                <input id="s-name" placeholder="ÃœrÃ¼n AdÄ±" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                <div class="flex gap-2">
                    <input id="s-price" type="number" placeholder="Fiyat" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                    <input id="s-icon" placeholder="Ä°kon (Emoji)" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                </div>
                <select id="s-type" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                    <option value="badge">Rozet</option><option value="effect">Ä°sim Efekti</option>
                </select>
                <input id="s-effect" placeholder="Efekt Class (Opsiyonel)" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                <div class="flex gap-2 mt-2">
                    <button onclick="window.admin.closeModal('modal-add-shop')" class="flex-1 bg-slate-700 text-white py-2 rounded">Ä°ptal</button>
                    <button onclick="window.admin.addShopItem()" class="flex-1 bg-yellow-600 hover:bg-yellow-500 text-white py-2 rounded font-bold">Ekle</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-add-game" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-full max-w-sm p-6 rounded-2xl border border-slate-600">
            <h3 class="text-xl font-bold text-white mb-4">Yeni Oyun Ekle</h3>
            <div class="space-y-3">
                <input id="g-title" placeholder="Oyun BaÅŸlÄ±ÄŸÄ±" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                <select id="g-cat" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                    <option>Tarih</option><option>CoÄŸrafya</option><option>Bilim</option>
                </select>
                <input id="g-img" placeholder="Kapak Resmi URL" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                <input id="g-url" placeholder="Oyun Embed Linki" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-white">
                <div class="flex gap-2 mt-2">
                    <button onclick="window.admin.closeModal('modal-add-game')" class="flex-1 bg-slate-700 text-white py-2 rounded">Ä°ptal</button>
                    <button onclick="window.admin.addGame()" class="flex-1 bg-green-600 hover:bg-green-500 text-white py-2 rounded font-bold">Ekle</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, deleteDoc, getDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyD5SFoL8-4idNlbixCw81pjWMn6M6-yv1A", authDomain: "kasif-cd133.firebaseapp.com", projectId: "kasif-cd133", storageBucket: "kasif-cd133.firebasestorage.app", messagingSenderId: "734052460302", appId: "1:734052460302:web:9c8b1747e3dcbdff6c195f", measurementId: "G-VZ04P8EQ69" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app, "kasif");

        let currentUserId = null;
        let currentUserData = null;

        // GLOBAL ADMIN OBJESÄ°
        window.admin = {
            switchTab: (tab) => {
                document.querySelectorAll('.content-tab').forEach(el => el.classList.add('hidden'));
                document.getElementById(`tab-${tab}`).classList.remove('hidden');
                if(tab==='users') window.admin.loadUsers();
                if(tab==='shop') window.admin.loadShop();
                if(tab==='games') window.admin.loadGames();
            },

            openModal: (id) => document.getElementById(id).classList.remove('hidden'),
            closeModal: (id) => document.getElementById(id).classList.add('hidden'),

            // --- KULLANICILAR ---
            loadUsers: async () => {
                const grid = document.getElementById('users-grid'); grid.innerHTML = '<div class="text-white">YÃ¼kleniyor...</div>';
                try {
                    const snap = await getDocs(collection(db, "users"));
                    grid.innerHTML = '';
                    let count = 0;
                    snap.forEach(d => {
                        count++;
                        const u = d.data();
                        let roleBadge = u.role === 'teacher' ? '<span class="bg-orange-500 text-white px-2 py-0.5 rounded text-[10px] font-bold">Ã–ÄRETMEN</span>' : '<span class="bg-slate-700 text-slate-300 px-2 py-0.5 rounded text-[10px]">Ã–ÄRENCÄ°</span>';
                        let statusDot = u.onlineStatus === 'online' ? 'bg-green-500' : 'bg-slate-500';
                        if(u.onlineStatus === 'banned') statusDot = 'bg-red-600';

                        grid.innerHTML += `
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 flex items-center justify-between group hover:border-blue-500 transition">
                            <div class="flex items-center gap-4">
                                <div class="relative">
                                    <img src="${u.avatar}" class="w-12 h-12 rounded-full bg-slate-700 object-cover">
                                    <div class="absolute bottom-0 right-0 w-3 h-3 ${statusDot} border-2 border-slate-800 rounded-full"></div>
                                </div>
                                <div>
                                    <div class="font-bold text-white flex items-center gap-2">${u.username} ${roleBadge}</div>
                                    <div class="text-xs text-slate-400 font-mono">${u.email}</div>
                                    <div class="text-xs text-yellow-500 font-bold mt-1">${u.coins||0} ğŸ’° | ${u.xp||0} XP</div>
                                </div>
                            </div>
                            <button onclick="window.admin.manageUser('${d.id}')" class="bg-slate-700 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold transition">YÃ¶net</button>
                        </div>`;
                    });
                    document.getElementById('stat-users').innerText = count;
                } catch(e) { console.error(e); }
            },

            manageUser: async (uid) => {
                currentUserId = uid;
                const docSnap = await getDoc(doc(db, "users", uid));
                if(docSnap.exists()) {
                    currentUserData = docSnap.data();
                    document.getElementById('m-avatar').src = currentUserData.avatar;
                    document.getElementById('m-username').innerText = currentUserData.username;
                    document.getElementById('m-email').innerText = currentUserData.email;
                    document.getElementById('m-coins').value = currentUserData.coins || 0;
                    document.getElementById('m-xp').value = currentUserData.xp || 0;
                    document.getElementById('m-title').value = currentUserData.title || '';
                    
                    const btnRole = document.getElementById('btn-role');
                    if(currentUserData.role === 'teacher') {
                        btnRole.innerHTML = "ğŸ“ Ã–ÄŸretmenliÄŸi Al"; btnRole.className = "w-full bg-slate-700 text-slate-300 py-2 rounded font-bold text-sm";
                    } else {
                        btnRole.innerHTML = "ğŸ“ Ã–ÄŸretmen Yap"; btnRole.className = "w-full bg-orange-900/50 hover:bg-orange-600 text-orange-200 border border-orange-700/50 py-2 rounded font-bold text-sm transition";
                    }

                    const btnBan = document.getElementById('btn-ban');
                    if(currentUserData.onlineStatus === 'banned') {
                        btnBan.innerHTML = "âœ… YasaÄŸÄ± KaldÄ±r"; btnBan.className = "flex-1 bg-green-900 hover:bg-green-700 text-green-400 border border-green-900 py-2 rounded font-bold text-sm transition";
                    } else {
                        btnBan.innerHTML = "ğŸš« Yasakla"; btnBan.className = "flex-1 bg-red-950 hover:bg-red-700 text-red-400 border border-red-900 py-2 rounded font-bold text-sm transition";
                    }

                    const bDiv = document.getElementById('m-badges'); bDiv.innerHTML = '';
                    if(currentUserData.badges) currentUserData.badges.forEach(b => bDiv.innerHTML += `<span title="${b.name}">${b.icon}</span>`);

                    document.getElementById('modal-manage-user').classList.remove('hidden');
                }
            },

            saveUserChanges: async () => {
                const coins = parseInt(document.getElementById('m-coins').value);
                const xp = parseInt(document.getElementById('m-xp').value);
                const title = document.getElementById('m-title').value;
                await updateDoc(doc(db, "users", currentUserId), { coins, xp, title });
                Swal.fire('BaÅŸarÄ±lÄ±', 'Kaydedildi.', 'success');
                window.admin.loadUsers();
            },

            toggleTeacherRole: async () => {
                const newRole = currentUserData.role === 'teacher' ? 'student' : 'teacher';
                await updateDoc(doc(db, "users", currentUserId), { role: newRole });
                window.admin.manageUser(currentUserId); window.admin.loadUsers();
                Swal.fire('Rol DeÄŸiÅŸti', `Yeni Rol: ${newRole}`, 'success');
            },

            banUser: async () => {
                const newStatus = currentUserData.onlineStatus === 'banned' ? 'offline' : 'banned';
                await updateDoc(doc(db, "users", currentUserId), { onlineStatus: newStatus });
                window.admin.manageUser(currentUserId); window.admin.loadUsers();
                Swal.fire('Ä°ÅŸlem Tamam', `Durum: ${newStatus}`, 'warning');
            },

            deleteUser: async () => {
                if(confirm("KullanÄ±cÄ± silinecek. Emin misin?")) {
                    await deleteDoc(doc(db, "users", currentUserId));
                    document.getElementById('modal-manage-user').classList.add('hidden');
                    window.admin.loadUsers();
                    Swal.fire('Silindi', 'KullanÄ±cÄ± uÃ§uruldu.', 'success');
                }
            },

            giveBadgePrompt: async () => {
                const badges = {
                    'b1': 'ğŸš€ Uzay Ã‡Ä±raÄŸÄ±', 'b2': 'â­ Parlayan YÄ±ldÄ±z', 'b3': 'ğŸ§  Bilgi KÃ¼pÃ¼',
                    'b4': 'ğŸ¨ SanatÃ§Ä±', 'b5': 'ğŸŒ DÃ¼nya Dostu', 'b6': 'ğŸ‘‘ Lider', 'b7': 'ğŸ† Åampiyon'
                };
                const { value: badgeId } = await Swal.fire({ title: 'Rozet SeÃ§', input: 'select', inputOptions: badges, showCancelButton: true });
                if (badgeId) {
                    const icon = badges[badgeId].split(' ')[0];
                    const name = badges[badgeId].split(' ').slice(1).join(' ');
                    const badgeObj = { id: badgeId, name: name, icon: icon, date: new Date().toISOString(), type: 'reward' };
                    await updateDoc(doc(db, "users", currentUserId), { badges: arrayUnion(badgeObj) });
                    Swal.fire('GÃ¶nderildi', 'Rozet verildi.', 'success');
                    window.admin.manageUser(currentUserId);
                }
            },

            sendWarningPrompt: async () => {
                const { value: text } = await Swal.fire({title: 'UyarÄ± MesajÄ±', input: 'text', showCancelButton: true});
                if(text) {
                    await addDoc(collection(db, "messages"), {
                        text: `âš ï¸ YÃ–NETÄ°CÄ° UYARISI: ${text}`, senderId: 'ADMIN', senderName: 'YÃ–NETÄ°M', avatar: 'https://cdn-icons-png.flaticon.com/512/10308/10308979.png', timestamp: new Date()
                    });
                    Swal.fire('GÃ¶nderildi', 'UyarÄ± sohbete dÃ¼ÅŸtÃ¼.', 'success');
                }
            },

            // --- MAÄAZA ---
            loadShop: async () => {
                const grid = document.getElementById('shop-grid'); grid.innerHTML = 'YÃ¼kleniyor...';
                const s = await getDocs(collection(db, "shop_items")); grid.innerHTML = '';
                s.forEach(d => {
                    const i = d.data();
                    grid.innerHTML += `
                    <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 relative text-center">
                        <button onclick="window.admin.delItem('shop_items','${d.id}')" class="absolute top-2 right-2 text-red-500 hover:text-white"><i class="fa-solid fa-trash"></i></button>
                        <div class="text-4xl mb-2">${i.icon}</div>
                        <div class="font-bold">${i.name}</div>
                        <div class="text-yellow-400 font-mono">${i.price} ğŸ’°</div>
                    </div>`;
                });
            },
            addShopItem: async () => {
                await addDoc(collection(db,"shop_items"), {
                    name: document.getElementById('s-name').value, price: Number(document.getElementById('s-price').value),
                    icon: document.getElementById('s-icon').value, type: document.getElementById('s-type').value, effectClass: document.getElementById('s-effect').value
                });
                document.getElementById('modal-add-shop').classList.add('hidden'); window.admin.loadShop();
            },

            // --- OYUNLAR ---
            loadGames: async () => {
                const grid = document.getElementById('games-grid'); grid.innerHTML = 'YÃ¼kleniyor...';
                const s = await getDocs(collection(db, "games")); grid.innerHTML = '';
                s.forEach(d => {
                    const g = d.data();
                    grid.innerHTML += `
                    <div class="bg-slate-800 p-2 rounded-xl border border-slate-700 relative">
                        <img src="${g.img}" class="w-full h-24 object-cover rounded opacity-50">
                        <div class="font-bold text-center mt-2">${g.title}</div>
                        <button onclick="window.admin.delItem('games','${d.id}')" class="absolute top-2 right-2 bg-red-600 px-2 rounded text-white text-xs">Sil</button>
                    </div>`;
                });
            },
            addGame: async () => {
                await addDoc(collection(db,"games"), {
                    title: document.getElementById('g-title').value, cat: document.getElementById('g-cat').value,
                    img: document.getElementById('g-img').value, url: document.getElementById('g-url').value
                });
                document.getElementById('modal-add-game').classList.add('hidden'); window.admin.loadGames();
            },

            delItem: async (col, id) => { if(confirm('Sil?')) { await deleteDoc(doc(db,col,id)); col==='games'?window.admin.loadGames():window.admin.loadShop(); } }
        };

        onAuthStateChanged(auth, u => { if(u) window.admin.loadUsers(); else location.href="login.html"; });
    </script>
</body>
</html>
